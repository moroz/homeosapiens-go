// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: carts.sql

package queries

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const getCart = `-- name: GetCart :one
select c.id, count(cli.id), sum(cli.quantity * e.base_price_amount)
from carts c
join cart_line_items cli on cli.cart_id = c.id
join events e on cli.event_id = e.id
where c.id = ($1::text)::uuid
group by 1
`

type GetCartRow struct {
	ID    pgtype.UUID `json:"id"`
	Count int64       `json:"count"`
	Sum   int64       `json:"sum"`
}

func (q *Queries) GetCart(ctx context.Context, cartID string) (*GetCartRow, error) {
	row := q.db.QueryRow(ctx, getCart, cartID)
	var i GetCartRow
	err := row.Scan(&i.ID, &i.Count, &i.Sum)
	return &i, err
}

const insertCart = `-- name: InsertCart :one
insert into carts (owner_id) values ($1) returning id, owner_id, inserted_at, updated_at
`

func (q *Queries) InsertCart(ctx context.Context, ownerID pgtype.UUID) (*Cart, error) {
	row := q.db.QueryRow(ctx, insertCart, ownerID)
	var i Cart
	err := row.Scan(
		&i.ID,
		&i.OwnerID,
		&i.InsertedAt,
		&i.UpdatedAt,
	)
	return &i, err
}

const insertCartLineItem = `-- name: InsertCartLineItem :one
insert into cart_line_items (cart_id, event_id) values ($1, $2) on conflict (cart_id, event_id) do update set quantity = quantity + excluded.quantity returning id, cart_id, event_id, quantity, inserted_at, updated_at
`

type InsertCartLineItemParams struct {
	CartID  pgtype.UUID `json:"cartId"`
	EventID pgtype.UUID `json:"eventId"`
}

func (q *Queries) InsertCartLineItem(ctx context.Context, arg *InsertCartLineItemParams) (*CartLineItem, error) {
	row := q.db.QueryRow(ctx, insertCartLineItem, arg.CartID, arg.EventID)
	var i CartLineItem
	err := row.Scan(
		&i.ID,
		&i.CartID,
		&i.EventID,
		&i.Quantity,
		&i.InsertedAt,
		&i.UpdatedAt,
	)
	return &i, err
}
